(function(){var n,e,t,r,o,i,l,u,a,c,s,m,d,f,v,p,y,h,g,w,b,I,x,k,j,T,A,C;j=window.window.teacup,k=j.span,o=j.div,n=j.a,a=j.h1,c=j.h3,g=j.p,s=j.iframe,w=j.raw,x=j.script,e=j.coffeescript,v=j.link,f=j.input,m=j.img,h=null,C=/(youtube.com|youtu\.be)\/(watch\?|embed\/|v\/|e\/|)(v=)?([^\#\&\?]*)/i,p=function(n,e){return setInterval(e,1e3*n)},T=function(n){var e,t;return t=0,e=n.split(":").reverse(),e[0]&&(t+=parseInt(e[0])),e[1]&&(t+=60*parseInt(e[1])),e[2]&&(t+=60*parseInt(e[2])*60),e[3]&&(t+=24*parseInt(e[3])*60*60),t},t=function(){return function(e){return j.render(function(){return o(".animated fadeIn",function(){var t,r,i,l,u,a;return n(".name",{href:"/channel/"+(null!=(t=e[0])&&null!=(r=t.total)&&null!=(i=r.yt$channelId)?i.$t:void 0)},function(){var n;return""+(null!=(n=e[0])?n.name:void 0)}),k(".description",function(){var n;return null!=(n=e[0])?n.text:void 0}),(null!=(l=e[0])&&null!=(u=l.reply)&&null!=(a=u.object)?a.content:void 0)?o(".reply",function(){return k(".name",function(){var n,t,r;return""+(null!=(n=e[0])&&null!=(t=n.reply)&&null!=(r=t.actor)?r.displayName:void 0)+": "}),k(function(){var n,t,r;return w(""+(null!=(n=e[0])&&null!=(t=n.reply)&&null!=(r=t.object)?r.content:void 0))})}):void 0})})}}(this),A=null,b=function(){return function(n){var e;return console.log("render",n),e=$("#player-api > #overlay-wrapper .comment"),e.html(t(n)),A&&clearTimeout(A),A=setTimeout(function(){var n;return n=e.find(".fadeIn"),n.toggleClass("fadeIn fadeOut"),n.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){return $(this).remove(),h=null})},8e3)}}(this),r=$("#movie_player > div.html5-video-controls > div.html5-player-chrome > span > div.ytp-time-display.html5-control > span.ytp-time-current"),i=$("#movie_player > div.html5-video-controls > div.html5-player-chrome > span > div.ytp-time-display.html5-control > span.ytp-time-duration"),l=[],y=C.exec(window.location.href)[4],d=!1,u=!1,I=null,p(.9,function(){var n,e,a,c;if($("#player-api").length&&i.length&&r.length)return c=C.exec(window.location.href)[4],c!==y&&(d=!1),d?(n=T(r.text()),a=l[n],a&&h!==a?(h=a,b(a)):void 0):(I&&clearTimeout(I),I=setTimeout(function(){return u===!1?(console.log("init failed trying again"),d=u):console.log("init succeeded")},8e3),$("#player-api > #overlay-wrapper").remove(),$("html").removeClass("youtube-social"),d=!0,console.log("INITIALIZED"),y=C.exec(window.location.href)[4],e=function(){return function(n){var e,r,a;for(null==n&&(n=368),e=[],r=0;n>0;)a=50*r+1,e[r]="https://gdata.youtube.com/feeds/api/videos/"+y+"/comments?start-index="+a+"&max-results=50&alt=json",n-=50,r++;return l=[],async.each(e,function(n,e){return console.log(n),$.getJSON(n,function(){return function(n){var t,r,o,i,u,a,c,s,m,d,f,v,p,y,h;if(!(null!=n&&null!=(s=n.feed)&&null!=(m=s.entry)?m.length:void 0))return e();for(f=null!=n&&null!=(d=n.feed)?d.entry:void 0,a=0,c=f.length;c>a;a++)r=f[a],t=r.content.$t,o=t.match(/(\d+:[\d:]+)/g),u=null!=o?o[0]:void 0,u&&((null!=o?o.length:void 0)>1||(i=T(u),null==l[i]&&(l[i]=[]),l[i].push({text:null!=(v=r.content)?v.$t:void 0,name:null!=(p=r.author[0].name)?p.$t:void 0,image_link:null!=(y=r.author[0])&&null!=(h=y.uri)?h.$t:void 0,total:r})));return e()}}(this))},function(){var n;return n=Object.keys(l),async.each(n,function(n,e){var t,r;return t=l[n],r=Object.keys(t),async.each(r,function(e,t){return function(){return function(){var r,o,i,u,a;return i=l[n][e],o=i.name,u=i.text,r=i.image_link,a=i.total,async.parallel({reply:function(n){var e,t;return/\?|song/gi.test(u)&&0!==a.yt$replyCount.$t?(i.type="reply",e=null!=(t=a.id.$t.match(/comments\/(.+)$/))?t[1]:void 0,chrome.runtime.sendMessage({id:e,type:"youtube-comments"},function(e){return i.reply=null!=e?e.items[0]:void 0,n()})):(i.type="message",n())},image_fix:function(n){return $.ajax({url:""+r+"?alt=json",dataType:"json",success:function(){return function(e){var t,r;return i.image=null!=e&&null!=(t=e.entry)&&null!=(r=t.media$thumbnail)?r.url:void 0,n()}}(this),error:function(){return n()}})}},function(){return t()})}}(this)()},function(){return e()})},function(){var e;return u=!0,console.log(l,"entries"),$("#player-api > #overlay-wrapper").remove(),$("#player-api").append(j.render(function(){return function(){return o("#overlay-wrapper",function(){return o(".images",function(){var n,e,t,r;r=[];for(e in l)n=l[e],n&&(t=e/T(i.text())*100,r.push(n[0].image?o(".image",{key:e,style:"left: "+t+"%;"},function(){return m({src:""+n[0].image}),o(".image-hover",function(){return m({src:""+n[0].image})})}):void 0));return r}),o(".comment-wrapper",function(){return o(".comment"),o(".hover-comment")})})}}(this))),n.length?$("html").addClass("youtube-social"):$("html").removeClass("youtube-social"),e=$("#player-api #overlay-wrapper .images > .image"),e.mouseenter(function(n){var e,r,o;return e=$(n.currentTarget),o=l[e.attr("key")],r=e.closest("#overlay-wrapper").find(".hover-comment"),r.html(t(o)),r.siblings(".comment").hide()}),e.mouseleave(function(n){var e,t,r;return e=$(n.currentTarget),r=e.closest("#overlay-wrapper").find(".hover-comment"),t=r.find(".fadeIn"),t.toggleClass("fadeIn fadeOut"),t.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){return $(this).remove(),r.siblings(".comment").show()})})})})}}(this),chrome.runtime.sendMessage({id:y,type:"youtube-stats"},function(n){var t,r,o;return t=Math.max(1e3,null!=n&&null!=(r=n.items[0])&&null!=(o=r.statistics)?o.commentCount:void 0),e()}))})}).call(this);
